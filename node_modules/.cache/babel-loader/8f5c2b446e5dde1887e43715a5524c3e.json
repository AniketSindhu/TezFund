{"ast":null,"code":"import _slicedToArray from\"/Users/aniketsindhu/Documents/React projects/crowdfunding_tezos_dapp/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import ProgressBar from\"@ramonak/react-progress-bar\";import{useState,useEffect}from\"react\";import axios from\"axios\";import config from\"../config/config\";import LoadingButton from\"@mui/lab/LoadingButton\";import{Chip}from\"@mui/material\";/**\n * @param {{Tezos: TezosToolkit}}\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ProjectOngoing(_ref){var projectDetails=_ref.projectDetails,Tezos=_ref.Tezos,userAddress=_ref.userAddress;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),fundingList=_useState2[0],setProjectFunding=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),contractBalance=_useState4[0],setContractBalance=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),amountToFund=_useState6[0],setAmountToFund=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),loading1=_useState8[0],setLoading1=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading2=_useState10[0],setLoading2=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),loading3=_useState12[0],setLoading3=_useState12[1];var handleAmountToFundChange=function handleAmountToFundChange(event){setAmountToFund(event.target.value);};var addFund=function addFund(){setLoading1(true);Tezos.wallet.at(projectDetails.address).then(function(contract){console.log(contract.entrypoints);try{contract.methods.send_fund().send({amount:parseFloat(amountToFund)*Math.pow(10,6),mutez:true}).then(function(op){return op.confirmation();}).then(function(result){if(result.completed){setLoading1(false);axios.get(config.API_URL_Project+projectDetails.address).then(function(response){setContractBalance(response.data.balance);});axios.get(config.API_URL_Project+projectDetails.address+\"/storage\").then(function(response){setProjectFunding(response.data.funding);});}});}catch(e){console.log(e);setLoading1(false);}});};var withdraw=function withdraw(){setLoading2(true);Tezos.wallet.at(projectDetails.address).then(function(contract){console.log(contract.entrypoints);try{contract.methods.refund().send().then(function(op){return op.confirmation();}).then(function(result){if(result.completed){setLoading2(false);axios.get(config.API_URL_Project+projectDetails.address).then(function(response){setContractBalance(response.data.balance);});axios.get(config.API_URL_Project+projectDetails.address+\"/storage\").then(function(response){setProjectFunding(response.data.funding);});}});}catch(e){console.log(e);setLoading2(false);}});};var claim=function claim(){setLoading3(true);Tezos.wallet.at(projectDetails.address).then(function(contract){console.log(contract.entrypoints);try{contract.methods.pay_off().send().then(function(op){return op.confirmation();}).then(function(result){if(result.completed){setLoading3(false);axios.get(config.API_URL_Project+projectDetails.address).then(function(response){setContractBalance(response.data.balance);});axios.get(config.API_URL_Project+projectDetails.address+\"/storage\").then(function(response){setProjectFunding(response.data.funding);});}});}catch(e){console.log(e);setLoading3(false);}});};useEffect(function(){var getProjectInfo=function getProjectInfo(){console.log(config.API_URL_Project+projectDetails.address+\"/storage\");axios.get(config.API_URL_Project+projectDetails.address+\"/storage\").then(function(response){setProjectFunding(response.data.funding);});axios.get(config.API_URL_Project+projectDetails.address).then(function(response){setContractBalance(response.data.balance);});};getProjectInfo();},[projectDetails.address]);return/*#__PURE__*/_jsxs(\"div\",{style:{height:\"250px\",width:\"100%\",padding:\"15px\",backgroundColor:\"white\",boxShadow:\"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)\",display:\"flex\",flexDirection:\"column\",alignItems:\"start\",marginBottom:\"20px\"},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"row\",alignItems:\"center\"},children:[new Date(projectDetails.data.endTime)>Date.now()?/*#__PURE__*/_jsx(Chip,{style:{backgroundColor:\"#1976D2\",marginRight:\"15px\",color:\"white\"},label:\"Ongoing\"}):contractBalance>=projectDetails.data.goalAmount?/*#__PURE__*/_jsx(Chip,{style:{backgroundColor:\"#19D266\",marginRight:\"15px\",color:\"white\"},label:\"Ended Successfully\"}):/*#__PURE__*/_jsx(Chip,{style:{backgroundColor:\"#D21932\",marginRight:\"15px\",color:\"white\"},label:\"Failed\"}),/*#__PURE__*/_jsx(\"h2\",{style:{margin:0},children:projectDetails.data.name})]}),/*#__PURE__*/_jsx(\"div\",{style:{margin:\"10px 0px 10px 0px\"},children:projectDetails.data.description}),/*#__PURE__*/_jsxs(\"div\",{style:{margin:\"10px 0px 10px 0px\"},children:[\"Time: \",new Date(projectDetails.data.endTime).toUTCString()]}),/*#__PURE__*/_jsxs(\"div\",{style:{margin:\"10px 0px 15px 0px\"},children:[\"Funded \",/*#__PURE__*/_jsxs(\"b\",{children:[contractBalance/Math.pow(10,6),\" Tez\"]}),\" out of goal of\",\" \",/*#__PURE__*/_jsxs(\"b\",{children:[projectDetails.data.goalAmount/Math.pow(10,6),\" Tez\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"row\"},children:[new Date(projectDetails.data.endTime)>Date.now()&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",onChange:handleAmountToFundChange,placeholder:\"Amount in Tez\",style:{padding:\"6px\"}}),/*#__PURE__*/_jsx(LoadingButton,{loading:loading1,onClick:addFund,variant:\"contained\",style:{margin:\"0px 10px 0px 10px\"},children:\"Fund Project\"})]}),fundingList&&fundingList.hasOwnProperty(userAddress)&&/*#__PURE__*/_jsxs(LoadingButton,{loading:loading2,onClick:withdraw,variant:\"contained\",style:{margin:\"0px 10px 0px 10px\"},children:[\"Withdraw \",fundingList[userAddress]/Math.pow(10,6),\" Tez\"]}),projectDetails.data.owner===userAddress&&contractBalance>=projectDetails.data.goalAmount&&new Date(projectDetails.data.endTime)<Date.now()&&/*#__PURE__*/_jsx(LoadingButton,{loading:loading3,onClick:claim,variant:\"contained\",style:{margin:\"0px 10px 0px 10px\"},children:\"Claim Funds\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:\"20px\",display:\"flex\",flexDirection:\"row\",alignItems:\"center\",justifyContent:\"space-between\",width:\"100%\"},children:[/*#__PURE__*/_jsx(\"b\",{children:\"0 Tez\"}),/*#__PURE__*/_jsx(ProgressBar,{completed:contractBalance/projectDetails.data.goalAmount*100,customLabel:\" \".concat(contractBalance/Math.pow(10,6),\" Tez\"),margin:\"10px\",width:\"55rem\",bgColor:\"#1976D2\"}),/*#__PURE__*/_jsxs(\"b\",{children:[projectDetails.data.goalAmount/Math.pow(10,6),\" Tez\"]})]})]});}export default ProjectOngoing;","map":{"version":3,"sources":["/Users/aniketsindhu/Documents/React projects/crowdfunding_tezos_dapp/src/components/ProjectOngoing.jsx"],"names":["React","ProgressBar","useState","useEffect","axios","config","LoadingButton","Chip","ProjectOngoing","projectDetails","Tezos","userAddress","fundingList","setProjectFunding","contractBalance","setContractBalance","amountToFund","setAmountToFund","loading1","setLoading1","loading2","setLoading2","loading3","setLoading3","handleAmountToFundChange","event","target","value","addFund","wallet","at","address","then","contract","console","log","entrypoints","methods","send_fund","send","amount","parseFloat","mutez","op","confirmation","result","completed","get","API_URL_Project","response","data","balance","funding","e","withdraw","refund","claim","pay_off","getProjectInfo","height","width","padding","backgroundColor","boxShadow","display","flexDirection","alignItems","marginBottom","Date","endTime","now","marginRight","color","goalAmount","margin","name","description","toUTCString","hasOwnProperty","owner","marginTop","justifyContent"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ProgressBar from \"@ramonak/react-progress-bar\";\nimport { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport config from \"../config/config\";\nimport LoadingButton from \"@mui/lab/LoadingButton\";\nimport { Chip } from \"@mui/material\";\n\n/**\n * @param {{Tezos: TezosToolkit}}\n */\nfunction ProjectOngoing({ projectDetails, Tezos, userAddress }) {\n  const [fundingList, setProjectFunding] = useState(null);\n  const [contractBalance, setContractBalance] = useState(0);\n  const [amountToFund, setAmountToFund] = useState(0);\n  const [loading1, setLoading1] = useState(false);\n  const [loading2, setLoading2] = useState(false);\n  const [loading3, setLoading3] = useState(false);\n  const handleAmountToFundChange = (event) => {\n    setAmountToFund(event.target.value);\n  };\n\n  const addFund = () => {\n    setLoading1(true);\n    Tezos.wallet.at(projectDetails.address).then((contract) => {\n      console.log(contract.entrypoints);\n      try {\n        contract.methods\n          .send_fund()\n          .send({ amount: parseFloat(amountToFund) * 10 ** 6, mutez: true })\n          .then((op) => {\n            return op.confirmation();\n          })\n          .then((result) => {\n            if (result.completed) {\n              setLoading1(false);\n              axios\n                .get(config.API_URL_Project + projectDetails.address)\n                .then((response) => {\n                  setContractBalance(response.data.balance);\n                });\n              axios\n                .get(\n                  config.API_URL_Project + projectDetails.address + \"/storage\"\n                )\n                .then((response) => {\n                  setProjectFunding(response.data.funding);\n                });\n            }\n          });\n      } catch (e) {\n        console.log(e);\n        setLoading1(false);\n      }\n    });\n  };\n\n  const withdraw = () => {\n    setLoading2(true);\n    Tezos.wallet.at(projectDetails.address).then((contract) => {\n      console.log(contract.entrypoints);\n      try {\n        contract.methods\n          .refund()\n          .send()\n          .then((op) => {\n            return op.confirmation();\n          })\n          .then((result) => {\n            if (result.completed) {\n              setLoading2(false);\n              axios\n                .get(config.API_URL_Project + projectDetails.address)\n                .then((response) => {\n                  setContractBalance(response.data.balance);\n                });\n              axios\n                .get(\n                  config.API_URL_Project + projectDetails.address + \"/storage\"\n                )\n                .then((response) => {\n                  setProjectFunding(response.data.funding);\n                });\n            }\n          });\n      } catch (e) {\n        console.log(e);\n        setLoading2(false);\n      }\n    });\n  };\n\n  const claim = () => {\n    setLoading3(true);\n    Tezos.wallet.at(projectDetails.address).then((contract) => {\n      console.log(contract.entrypoints);\n      try {\n        contract.methods\n          .pay_off()\n          .send()\n          .then((op) => {\n            return op.confirmation();\n          })\n          .then((result) => {\n            if (result.completed) {\n              setLoading3(false);\n              axios\n                .get(config.API_URL_Project + projectDetails.address)\n                .then((response) => {\n                  setContractBalance(response.data.balance);\n                });\n              axios\n                .get(\n                  config.API_URL_Project + projectDetails.address + \"/storage\"\n                )\n                .then((response) => {\n                  setProjectFunding(response.data.funding);\n                });\n            }\n          });\n      } catch (e) {\n        console.log(e);\n        setLoading3(false);\n      }\n    });\n  };\n\n  useEffect(() => {\n    const getProjectInfo = () => {\n      console.log(config.API_URL_Project + projectDetails.address + \"/storage\");\n      axios\n        .get(config.API_URL_Project + projectDetails.address + \"/storage\")\n        .then((response) => {\n          setProjectFunding(response.data.funding);\n        });\n      axios\n        .get(config.API_URL_Project + projectDetails.address)\n        .then((response) => {\n          setContractBalance(response.data.balance);\n        });\n    };\n    getProjectInfo();\n  }, [projectDetails.address]);\n\n  return (\n    <div\n      style={{\n        height: \"250px\",\n        width: \"100%\",\n        padding: \"15px\",\n        backgroundColor: \"white\",\n        boxShadow:\n          \"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: \"start\",\n        marginBottom: \"20px\",\n      }}\n    >\n      <div\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          alignItems: \"center\",\n        }}\n      >\n        {new Date(projectDetails.data.endTime) > Date.now() ? (\n          <Chip\n            style={{\n              backgroundColor: \"#1976D2\",\n              marginRight: \"15px\",\n              color: \"white\",\n            }}\n            label=\"Ongoing\"\n          />\n        ) : contractBalance >= projectDetails.data.goalAmount ? (\n          <Chip\n            style={{\n              backgroundColor: \"#19D266\",\n              marginRight: \"15px\",\n              color: \"white\",\n            }}\n            label=\"Ended Successfully\"\n          />\n        ) : (\n          <Chip\n            style={{\n              backgroundColor: \"#D21932\",\n              marginRight: \"15px\",\n              color: \"white\",\n            }}\n            label=\"Failed\"\n          />\n        )}\n\n        <h2 style={{ margin: 0 }}>{projectDetails.data.name}</h2>\n      </div>\n      <div style={{ margin: \"10px 0px 10px 0px\" }}>\n        {projectDetails.data.description}\n      </div>\n      <div style={{ margin: \"10px 0px 10px 0px\" }}>\n        Time: {new Date(projectDetails.data.endTime).toUTCString()}\n      </div>\n      <div style={{ margin: \"10px 0px 15px 0px\" }}>\n        Funded <b>{contractBalance / 10 ** 6} Tez</b> out of goal of{\" \"}\n        <b>{projectDetails.data.goalAmount / 10 ** 6} Tez</b>\n      </div>\n\n      <div style={{ display: \"flex\", flexDirection: \"row\" }}>\n        {new Date(projectDetails.data.endTime) > Date.now() && (\n          <div>\n            <input\n              type=\"text\"\n              onChange={handleAmountToFundChange}\n              placeholder=\"Amount in Tez\"\n              style={{ padding: \"6px\" }}\n            />\n            <LoadingButton\n              loading={loading1}\n              onClick={addFund}\n              variant=\"contained\"\n              style={{\n                margin: \"0px 10px 0px 10px\",\n              }}\n            >\n              Fund Project\n            </LoadingButton>\n          </div>\n        )}\n\n        {fundingList && fundingList.hasOwnProperty(userAddress) && (\n          <LoadingButton\n            loading={loading2}\n            onClick={withdraw}\n            variant=\"contained\"\n            style={{\n              margin: \"0px 10px 0px 10px\",\n            }}\n          >\n            Withdraw {fundingList[userAddress] / 10 ** 6} Tez\n          </LoadingButton>\n        )}\n\n        {projectDetails.data.owner === userAddress &&\n          contractBalance >= projectDetails.data.goalAmount &&\n          new Date(projectDetails.data.endTime) < Date.now() && (\n            <LoadingButton\n              loading={loading3}\n              onClick={claim}\n              variant=\"contained\"\n              style={{\n                margin: \"0px 10px 0px 10px\",\n              }}\n            >\n              Claim Funds\n            </LoadingButton>\n          )}\n      </div>\n\n      <div\n        style={{\n          marginTop: \"20px\",\n          display: \"flex\",\n          flexDirection: \"row\",\n          alignItems: \"center\",\n          justifyContent: \"space-between\",\n          width: \"100%\",\n        }}\n      >\n        <b>0 Tez</b>\n        <ProgressBar\n          completed={(contractBalance / projectDetails.data.goalAmount) * 100}\n          customLabel={` ${contractBalance / 10 ** 6} Tez`}\n          margin=\"10px\"\n          width=\"55rem\"\n          bgColor=\"#1976D2\"\n        />\n        <b>{projectDetails.data.goalAmount / 10 ** 6} Tez</b>\n      </div>\n    </div>\n  );\n}\n\nexport default ProjectOngoing;\n"]},"metadata":{},"sourceType":"module"}